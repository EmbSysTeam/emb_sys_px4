# Mavlink 概述

> [!todo] 待审查

MAVLink 是一种完善的轻量级消息序列化协议，专用于无人驾驶车辆系统，包括无人机。 Lorenz Meier 在 LGPL 许可下于 2009 年发布了 MAVLink。 MAVLink 被设计为一个 Marshaling 库，这意味着它将系统状态的消息和它必须执行的命令序列化为特定的二进制格式（即字节流），这是平台无关的。 MAVLink 协议的二进制序列化特性使其轻量级，因为与其他序列化技术（例如 XML 或 JSON）相比，它的开销最小。使用 MAVLink 的通信在地面站和无人系统之间是双向的。此外，考虑到 MAVLink 的二进制序列化特性，它的消息通常很小，可以通过不同的无线介质可靠地传输，包括 WiFi 甚至低数据速率的串行遥测设备。它还通过数据包标头中的双重校验和验证来确保可靠性和消息完整性。所有这些特性使得 MAVLink 协议成为无人系统和 GCS 之间通信领域中最受欢迎的协议。

MAVLink 协议的优点在于，由于其轻量级结构，它支持不同类型的传输层和介质。它可以通过 WiFi、以太网（即 TCP/IP 网络）或以 sub-GHz 频率（即 433 MHz、868 MHz 或 915 MHz）运行的串行遥测低带宽通道进行传输。 Sub-GHz 频率使我们能够达到较大的通信范围，从而远程控制无人系统。

# 消息结构

## MALLink 1.0 协议头

![ | 600](asset/Pasted%20image%2020230701163452.png)

MAVLink 1.0 的最小消息长度是 8 个字节，用于没有有效载荷的确认数据包。MAVLink 1.0 消息的完整有效负载的最大长度为 263 字节。

协议标头八个重要字段：

| 缩略词 | 内容   | 描述                                                                         |
| ---------- | ---------- | -------------------------------------------------------------------------------- |
| STX        | 0xFE       | 它描述帧的开始，并且在 mavlink 1.0 的官方文档中始终为 0xfe。                     |
| LEN        | 0x00-0xFF  | 它的值描述了负载长度。                                                           |
| SEQ        | 0x00-0xFF  | 这部分消息显示了数据包的顺序。例如0代表第一条消息。用于检测丢失的mavlink数据包。 |
| SYS ID     | 0x01-0xFF  | 该字段代表无人系统的ID。                                                         |
| COMP ID    | 0x00-0xFF  | 该字段表示系统中的哪个组件正在发送消息。                                         |
| MSG ID     | 0x00-0xFF  | 该字段表示发送的消息类型。                                                       |
| PAYLOAD    | 0-255字节  | 这装载了消息的真实数据，并且由消息类型来解析。                                   |
| CHECKSUM   | 两字节内容 | CKA 和 CKB 称为校验和。数据包的签名从最低有效位（LSB）到最高有效位（MSB）进行。  |

## MAVLink 2.0 协议头

MAVLink 2.0协议头于2017年初发布，是目前推荐的版本。它向后兼容 MAVLink 1.0 版本，并包括对 MAVLink 1.0 版本的多项改进。MAVLink 2.0 标头与 MAVLink 1.0 标头共享所有字段，并添加了新字段，此外还更改了一些现有字段的大小。

![](asset/Pasted%20image%2020230701164008.png)

第一个字节是文本开始标记，其具体值为0xFD，有别于MAVLink 1.0 的0xFE。因此，解析器必须首先识别此字符，然后才能解析 MAVLink 2.0 消息的其余字段。有效载荷长度是下一个字段，与传统协议中的相同。 MAVLink 在消息的序列号 (SEQ) 之前引入了两个新标志。第一个标志是不兼容标志，这是影响消息结构的标志。这些标志指示数据包是否包含解析数据包时必须考虑的某些功能。例如，不兼容标志等于 0x01 意味着数据包已签名并且签名附加在数据包末尾。第二个标志是兼容性标志，它不影响消息的结构。它表示如果不理解可以忽略的标志，并且即使无法解释标志也不会阻止解析器处理消息。例如，这可以指指示数据包优先级的标志（例如，高优先级），因为它不影响数据包结构。序列号 (SEQ)、系统 ID (SYSID) 和组件 ID (COMPID) 与 MAVLink 1.0 协议标头中的相同。然而，消息 ID (MSGID) 被编码为 24 位而不是之前版本中的 8 位，这允许 MAVLink 2.0 中更多的消息类型，达到 16777215 种可能的类型。最后，MAVLink 2.0使用13字节的可选签名字段来确保链路防篡改。此功能显着提高了 MAVLink 1.0 的安全性，因为它允许对消息进行身份验证并验证它是否来自受信任的来源。如果不兼容标志设置为 0x01，则会附加消息签名。

> [!todo] 表格化

# 消息类型

**状态消息**：这些消息从无人系统发送到地面站，包含有关系统状态的信息，例如系统的 ID、位置、速度和高度。

**命令信息**：由地面站（或用户程序）发送给无人系统，由自动驾驶仪执行某些动作或任务。例如，地面站可以向无人机发送命令起飞或降落或前往一个航路点，甚至可以执行具有多个航路点的任务。

# 参考链接

[^1]: https://mavlink.io/en/messages/common.html